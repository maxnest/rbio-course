uniq_num <- sort(unique(x))
match(uniq_num, x)
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
match(uniq_num, x)
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
match(7, x)
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
match(2, x)
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
match(0, x)
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
match(5, x)
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
match(6, x)
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
sum(match(6, x))
}
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
sum(match(7, x))
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
uniq_num
sum(match(0, x))
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
rbind(uniq_num, sapply(uniq_num, function(y) sum[y == x])
}
count_elements <- function(x) {
uniq_num <- sort(unique(x))
rbind(uniq_num, sapply(uniq_num, function(y) sum[y == x]))
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
rbind(uniq_num, sapply(uniq_num, function(y) sum(y==x))
}
count_elements <- function(x) {
uniq_num <- sort(unique(x))
rbind(uniq_num, sapply(uniq_num, function(y) sum(y==x)))
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
answer <- rbind(uniq_num, sapply(uniq_num, function(y) sum(y==x)))
names(answer) <- NULL
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
answer <- rbind(uniq_num, sapply(uniq_num, function(y) sum(y==x)))
names(answer) <- NULL
answer
}
count_elements(x)
count_elements <- function(x) {
uniq_num <- sort(unique(x))
answer <- rbind(uniq_num, sapply(uniq_num, function(y) sum(y==x)))
rownames(answer) <- NULL
answer
}
count_elements(x)
built_stage <- function(n, k){
#фундамент
m <- matrix(0, nrow = 2*n - 1, ncol = 2*n - 1)
index <-[k:(2n - 1 - k)]
m[index, index] <- 1
}
built_stage <- function(n, k){
#фундамент
m <- matrix(0, 2*n - 1, 2*n - 1)
index <-[k:(2n - 1 - k)]
m[index, index] <- 1
}
built_stage <- function(n, k){
built_stage <- function(n, k){
#фундамент
m <- matrix(0, 2*n - 1, 2*n - 1)
ind <-k:(2n - 1 - k)
m[ind, ind] <- 1
}
built_stage <- function(n, k){
#фундамент
m <- matrix(0, 2*n - 1, 2*n - 1)
ind <-k:(2n - 1 - k)
m[ind, ind] <- 1
}
built_stage <- function(n, k){
#фундамент
m <- matrix(0, 2*n - 1, 2*n - 1)
ind <- k:(2*n - k)
m[ind, ind] <- 1
}
buil
built_stage(3, 1)
built_stage <- function(n, k){
#фундамент
m <- matrix(0, 2*n - 1, 2*n - 1)
ind <- k:(2*n - k)
m[ind, ind] <- 1
m
}
built_stage(3, 1)
built_stage <- function(n, k){
#фундамент
m <- matrix(0, 2*n - 1, 2*n - 1)
ind <- k:(2*n - k)
m[ind, ind] <- 1
m
}
built_stage(3, 3)
lapply(1:n, function(i) built_stage(n, i))
lapply(1:3, function(i) built_stage(3, i))
built_stage <- function(n, k){
#фундамент
m <- matrix(0, 2*n - 1, 2*n - 1)
ind <- k:(2*n - k)
m[ind, ind] <- 1
}
lapply(1:3, function(i) built_stage(3, i))
lapply(1:n, function(i) built_stage(n, i))
lapply(1:n, function(i) built_stage(n, i))
Reduce("+", lapply(1:n, function(x) built_stage(n, x)))
Reduce("+", lapply(1:3, function(x) built_stage(3, x)))
lapply(1:n, function(i) built_stage(n, i))
Reduce("+", lapply(1:3, function(x) built_stage(3, x)))
lapply(1:n, function(i) built_stage(n, i))
Reduce("+", lapply(1:n, function(x) built_stage(n, x)))
Reduce("+", lapply(1:n, function(x) built_stage(n, x)))
n <- 3
built_stage <- function(n, k){
#фундамент
m <- matrix(0, 2*n - 1, 2*n - 1)
ind <- k:(2*n - k)
m[ind, ind] <- 1
m
}
# функция Reduce() - операция с элементами в матрице
# Reduce("+",)
lapply(1:n, function(i) built_stage(n, i))
Reduce("+", lapply(1:n, function(x) built_stage(n, x)))
m <- matrix(3, 1, 1)
res <- matrix(n - 1, ncol=ncol(m) + 2, nrow=nrow(m) + 2)
res
res[2:(nrow(m) + 1), 2:(ncol(m) + 1)]
built <- function(m, n){
# m - матрица
# n - высота зиккурата
if (n == 1){
return(m)
} else {
res <- matrix(n - 1, ncol=ncol(m) + 2, nrow=nrow(m) + 2)
res[2:(nrow(m) + 1), 2:(ncol(m) + 1)] <- m
return(built(res, n - 1))
}
}
m <- matrix(0, 1, 1)
built(m, 3)
built_ziggurat <- function(n){
res_new <- matrix(n, 1, 1)
built(res_new, n)
}
built_ziggurat(3)
built_ziggurat(1)
built_ziggurat(5)
stringsAsFactors = FALSE)
test_data <- read.csv("https://stepik.org/media/attachments/course/724/test_data_01.csv",
stringsAsFactors = FALSE)
head(test_data)
library(stringr)
x_new <- as.numeric(x)
x <- "1 .25"
x_new <- as.numeric(x)
x <- "1.25"
x_new <- as.numeric(x)
x <- "1 .25"
x_new <- as.numeric(x)
gsub("+ .+", "+.+", x)
gsub(" ", ".", x)
gsub(" ", "", x)
as.numeric(gsub(" ", "", x))
fix_data <- function(df){
sapply(df, function(i) as.numeric(gsub(" ", "", i))
df
}
fix_data <- function(df){
sapply(df, function(i) as.numeric(gsub(" ", "", i))
return(df)
}
fix_data <- function(df){
apply(df, 1, function(i) as.numeric(gsub(" ", "", i))
return(df)
}
fig_strings <- function(x){
as.numeric(gsub(" ", "", x))
}
as.numeric(test)
test <- "TEST STRING"
as.numeric(test)
fix_data <- function(df){
sapply(df, function(i) ifelse{is.na(as.numeric(i)), i, fig_strings(i))
return(df)
}
fig_strings <- function(x){
if(all(is.na(x))){
return(x)
} else {
as.numeric(gsub(" ", "", x))
}
}
fix_data <- function(df){
sapply(df, function(i) fig_strings)
return(df)
}
fix_data(test_data)
fig_strings <- function(x){
if(all(is.na(as.numeric(gsub(" ", ""m x)))){
return(x)
} else {
as.numeric(gsub(" ", "", x))
}
}
fig_strings <- function(x){
if(all(is.na(as.numeric(gsub(" ", ""m x))))){
return(x)
} else {
as.numeric(gsub(" ", "", x))
}
}
fig_strings <- function(x){
if(all(is.na(as.numeric(gsub(" ", "", x))))){
return(x)
} else {
as.numeric(gsub(" ", "", x))
}
}
fix_data <- function(df){
sapply(df, function(i) fig_strings)
return(df)
}
fix_data(test_data)
library(dplyr)
mutate_all(test_data, fig_strings)
load("C:/Users/PC/Downloads/all_data.Rdata")
str(all_data)
all_data <- do.call(rbind, all_data)
all_data <- do.call(rbind, all_data)
str(all_data)
all_data$id <-factor(all_data$id)
all_data$id <- factor(all_data$id)
all_data <- do.call(rbind, all_data)
all_data <- do.call(rbind, all_data)
View(all_data)
rm(all_data)
load("C:/Users/PC/Downloads/all_data.Rdata")
all_data <- do.call(rbind, all_data)
all_data$id <- factor(all_data$id)
rm(all_data)
load("C:/Users/PC/Downloads/all_data.Rdata")
patients <- do.call(rbind, all_data)
(patients$id)
patients$id <- factor(patients$id)
sapply(all_data, nrow)
patients$day <- mapply(rep, 1:length(all_data),
sapply(all_data, nrow))
patients
rm(patients)
patients <- do.call(rbind, all_data)
patients$id <- factor(patients$id)
patients$day <- do.call(c, mapply(rep, 1:length(all_data),
sapply(all_data, nrow)))
patients
patients$day
grouped_patients <- group_by(patients, id, day)
grouped_patients
summarise(grouped_patients)
grouped_patients$id
table(grouped_patients)
rm(grouped_patients)
grouped_patients <- group_by(patients, id)
summarise(grouped_patients, n=n())
summarise(grouped_patients, n=n()) %>%  filter( n = 7)
summarise(grouped_patients, n=n()) %>%  filter( n == length(all_data))
for_doctor <- summarise(grouped_patients, n=n()) %>%  filter( n == length(all_data))
filter(patients, id %in% for_doctor$id) %>% group_by(id, day) %>%  summarise(mean_temp = mean(temp))
answer <- filter(patients, id %in% for_doctor$id) %>% group_by(id, day) %>%  summarise(mean_temp = mean(temp))
answer
install.packages("mclust")
install.packages("amap")
x <- c(rnorm(200, 10, 3), rnorm(200, 25,3), rnorm(200,35,3), rnorm(200,65, 3), rnorm(200,80,5))
xyColors <- c(rep("red", 200), rep("blue", 200), rep("green", 200), rep("black", 200), rep("magenta", 200))
y <- c(rnorm(1000, 30, 2))
plot(x, y, pch = 19, col = xyColors)
library(mclust)
xyMclust <- Mclust(data.frame (X,Y))
xyMclust <- Mclust(data.frame(x,y))
plot(xyMclust)
set.seed(1)
x <- c(rnorm(200, 10, 3), rnorm(200, 25,3), rnorm(200,35,3), rnorm(200,65, 3), rnorm(200,80,5))
xyColors <- c(rep("red", 200), rep("blue", 200), rep("green", 200), rep("black", 200), rep("magenta", 200))
y <- c(rnorm(1000, 30, 2))
plot(x, y, pch = 19, col = xyColors)
xyMclust <- Mclust(data.frame(x,y))
plot(xyMclust)
?Mclust
plot(xyMclust)
xyMclust
set.seed(10)
x <- c(rnorm(200, 10, 3), rnorm(200, 25,3), rnorm(200,35,3), rnorm(200,65, 3), rnorm(200,80,5))
xyColors <- c(rep("red", 200), rep("blue", 200), rep("green", 200), rep("black", 200), rep("magenta", 200))
y <- c(rnorm(1000, 30, 2))
plot(x, y, pch = 19, col = xyColors)
xyMclust <- Mclust(data.frame(x,y))
plot(xyMclust)
xyMclust
install.packages(c("ggplot2", "gplots", "fpc", "pvclust", "Hmisc"))
source("https://bioconductor.org/biocLite.R")
biocLite(c("Biobase", "prot2D", "impute", "pcaMethods", "limma"))
setwd("~/R/rna_seq/homework_2")
library(DESeq2)
library(ggplot2)
library(pheatmap)
library(amap)
library(dbscan)
options(width=120)
counts <- read.csv("GSE89225_Illumina_counts.csv", row.names=1)
conditions <- read.csv("conditions.csv", row.names=1)
projection <- read.csv("projection.csv", row.names = 1)
dds <- DESeqDataSetFromMatrix(countData = counts,
colData = conditions,
design = ~ tissue + cells)
dds <- dds[rowSums(counts(dds)) > 20, ]
dds
View(counts)
dds <- dds[order(rowSums(counts(dds))), ]
dds
dds <- head(dds, 8000)
dds <- DESeq(dds)
library(DESeq2)
library(ggplot2)
library(pheatmap)
library(amap)
library(dbscan)
options(width=120)
```
### Задание 1: Иерархическая кластеризация
```{r read_data, message=FALSE, error=FALSE, warning=FALSE}
counts <- read.csv("GSE89225_Illumina_counts.csv", row.names=1)
conditions <- read.csv("conditions.csv", row.names=1)
projection <- read.csv("projection.csv", row.names = 1)
dds <- DESeqDataSetFromMatrix(countData = counts,
colData = conditions,
design = ~ tissue + cells)
# select genes with "optimal" expression
dds <- dds[rowSums(counts(dds)) > 20, ]
dds <- dds[order(rowSums(counts(dds))), ]
# 8000 genes
dds <- head(dds, 8000)
# create object
dds <- DESeq(dds)
library(DESeq2)
library(ggplot2)
library(pheatmap)
library(amap)
library(dbscan)
options(width=120)
counts <- read.csv("GSE89225_Illumina_counts.csv", row.names=1)
conditions <- read.csv("conditions.csv", row.names=1)
projection <- read.csv("projection.csv", row.names = 1)
dds <- DESeqDataSetFromMatrix(countData = counts,
colData = conditions,
design = ~ tissue + cells)
# select genes with "optimal" expression
dds <- dds[rowSums(counts(dds)) > 20, ]
dds <- dds[order(rowSums(counts(dds)), decreasing = T), ]
# 8000 genes
dds <- head(dds, 8000)
# create object
dds <- DESeq(dds)
cor_samples <- cor(assay(rlog(dds)))
cor_dissim <- 1 - cor_samples
dissim_dist <- dist(cor_dissim)
clust_average <- hclust(dissim_dist, method="average")
clust_single <- hclust(dissim_dist, method="single")
clust_complete <- hclust(dissim_dist, method="complete")
# plots
plot(clust_average, main = "Cluster Dendrogram: Average")
plot(clust_single, main = "Cluster Dendrogram: Single")
plot(clust_complete, main = "Cluster Dendrogram: Complete")
counts <- select(counts, -(treg_NBP_patient3))
library(dplyr)
counts <- select(counts, -(treg_NBP_patient3))
conditions  <- conditions[-12, ]
rlg <- assay(rlog(dds))
clusters <- Kmeans(rlg, 6, method="correlation", iter.max = 20000)
cluster_df <- as.data.frame(clusters$cluster)
colnames(cluster_df) <- "cluster"
cluster_df$cluster <- as.factor(cluster_df$cluster)
order_data <- rlg[order(clusters$cluster),
order(conditions$cells, conditions$tissue)]
order_data <- t(apply(order_data, 1, function(r) {
(r - min(r)) / (max(r) - min(r))
}))
pheatmap(order_data,
show_rownames = F,
cluster_rows = F,
cluster_cols = F,
annotation_col = conditions, annotation_row = cluster_df)
library(DESeq2)
library(ggplot2)
library(pheatmap)
library(amap)
library(dbscan)
options(width=120)
library(dplyr)
counts <- read.csv("GSE89225_Illumina_counts.csv", row.names=1)
conditions <- read.csv("conditions.csv", row.names=1)
projection <- read.csv("projection.csv", row.names = 1)
dds <- DESeqDataSetFromMatrix(countData = counts,
colData = conditions,
design = ~ tissue + cells)
# select genes with "optimal" expression
dds <- dds[rowSums(counts(dds)) > 20, ]
dds <- dds[order(rowSums(counts(dds)), decreasing = T), ]
# 8000 genes
dds <- head(dds, 8000)
# create object
dds <- DESeq(dds)
# log expression and correlation, dissimilarity
cor_samples <- cor(assay(rlog(dds)))
cor_dissim <- 1 - cor_samples
dissim_dist <- dist(cor_dissim)
# clusters
clust_average <- hclust(dissim_dist, method="average")
clust_single <- hclust(dissim_dist, method="single")
clust_complete <- hclust(dissim_dist, method="complete")
# plots
plot(clust_average, main = "Cluster Dendrogram: Average")
plot(clust_single, main = "Cluster Dendrogram: Single")
plot(clust_complete, main = "Cluster Dendrogram: Complete")
counts <- select(counts, -(treg_NBP_patient3))
conditions  <- conditions[-12, ]
dds_2 <- DESeqDataSetFromMatrix(countData = counts,
colData = conditions,
design = ~ tissue + cells)
dds_2 <- dds_2[rowSums(counts(dds_2)) > 20, ]
dds_2 <- dds_2[order(rowSums(counts(dds_2)), decreasing = T), ]
# 8000 genes
dds_2 <- head(dds_2, 8000)
# create object
dds_2 <- DESeq(dds_2)
rlg_2 <- assay(rlog(dds_2))
clusters <- Kmeans(rlg_2, 6, method="correlation", iter.max = 20000)
# cluster - as factor for visualization
cluster_df <- as.data.frame(clusters$cluster)
colnames(cluster_df) <- "cluster"
cluster_df$cluster <- as.factor(cluster_df$cluster)
# order
order_data <- rlg[order(clusters$cluster),
order(conditions$cells, conditions$tissue)]
order_data <- rlg_2[order(clusters$cluster),
order(conditions$cells, conditions$tissue)]
order_data <- t(apply(order_data, 1, function(r) {
(r - min(r)) / (max(r) - min(r))
}))
# heatmap for ordered data
#png("heatmap_ordered_data.png", width=6, height=20, units="in", res=300)
pheatmap(order_data,
show_rownames = F,
cluster_rows = F,
cluster_cols = F,
annotation_col = conditions, annotation_row = cluster_df)
png("heatmap_ordered_data.png", width=6, height=20, units="in", res=300)
pheatmap(order_data,
show_rownames = F,
cluster_rows = F,
cluster_cols = F,
annotation_col = conditions, annotation_row = cluster_df)
dev.off()
